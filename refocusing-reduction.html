<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.0">
<title data-rh="true">Paper - Refocusing in Reduction Semantics | BYU Static Analysis / Programming Languages Lab</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://byu-static-analysis-lab.github.io/blog/refocusing-reduction"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Paper - Refocusing in Reduction Semantics | BYU Static Analysis / Programming Languages Lab"><meta data-rh="true" name="description" content="Refocusing in Reduction Semantics [@danvyrefocusing2004] presents a way to go from"><meta data-rh="true" property="og:description" content="Refocusing in Reduction Semantics [@danvyrefocusing2004] presents a way to go from"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-11-08T12:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/TimWhiting"><meta data-rh="true" property="article:tag" content="paper,abstract interpreters,reduction semantics"><link data-rh="true" rel="icon" href="/blog/img/byu-pl-logo.png"><link data-rh="true" rel="canonical" href="https://byu-static-analysis-lab.github.io/blog/refocusing-reduction"><link data-rh="true" rel="alternate" href="https://byu-static-analysis-lab.github.io/blog/refocusing-reduction" hreflang="en"><link data-rh="true" rel="alternate" href="https://byu-static-analysis-lab.github.io/blog/refocusing-reduction" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://byu-static-analysis-lab.github.io/blog/refocusing-reduction","mainEntityOfPage":"https://byu-static-analysis-lab.github.io/blog/refocusing-reduction","url":"https://byu-static-analysis-lab.github.io/blog/refocusing-reduction","headline":"Paper - Refocusing in Reduction Semantics","name":"Paper - Refocusing in Reduction Semantics","description":"Refocusing in Reduction Semantics [@danvyrefocusing2004] presents a way to go from","datePublished":"2024-11-08T12:00:00.000Z","author":{"@type":"Person","name":"Tim Whiting","description":"Author","url":"https://github.com/TimWhiting","image":"https://github.com/TimWhiting.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://byu-static-analysis-lab.github.io/blog/","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="BYU Static Analysis / Programming Languages Lab RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="BYU Static Analysis / Programming Languages Lab Atom Feed">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/blog/assets/css/styles.c721bfac.css">
<script src="/blog/assets/js/runtime~main.0d1c29bf.js" defer="defer"></script>
<script src="/blog/assets/js/main.70a6ca2b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/blog/"><div class="navbar__logo"><img src="/blog/img/byu-pl-logo.png" alt="Lab Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/blog/img/byu-pl-logo.png" alt="Lab Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">BYU Static Analysis / PL Lab</b></a><a class="navbar__item navbar__link" href="/blog/docs/Papers/algebraic-effects">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/byu-static-analysis-lab/blog/tree/main/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/db-aware-program-optimization">Paper - Database-Aware Program Optimization via Static Analysis</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/fine-grained-reduction-theory-for-effect-handlers">Paper - A General Fine-Grained Reduction Theory for Effect Handlers</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/refocusing-reduction">Paper - Refocusing in Reduction Semantics</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/flow-sensitivity">Topic - Flow Sensitivity</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/abstract-interpretation">Topic - Abstract Interpretation</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/galois-transformers">Paper - Galois Transformers and Modular Abstract Interpreters</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/abstracting-abstract-machines">Paper - Abstracting Abstract Machines</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/control-flow-analysis">Topic - Control Flow Analysis</a></li></ul></div></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">Paper - Refocusing in Reduction Semantics</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-11-08T12:00:00.000Z">November 8, 2024</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/TimWhiting" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://github.com/TimWhiting.png" alt="Tim Whiting"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/TimWhiting" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Tim Whiting</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Refocusing in Reduction Semantics <span id="citation--danvy_refocusing_2004--1">(Danvy and Nielsen Nov. 2004)</span> presents a way to go from
a reduction semantics to an refocused pre-abstract machine, and eventually to an abstract machine. The paper is a good read after being introduced to reduction semantics and abstract machines, and has a few simple walkthroughs of how to actually apply the theory.</p>
<p>The goal of this paper is to systematize the development of abstract machines based on
a reduction semantics.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="reduction-semantics">Reduction Semantics<a href="#reduction-semantics" class="hash-link" aria-label="Direct link to Reduction Semantics" title="Direct link to Reduction Semantics">​</a></h3>
<p>Reduction semantics involve three distinct steps:</p>
<ul>
<li><code>decompose</code>: rules for breaking apart expressions into a term that can be reduced and its surrounding evaluation contexts (aka reduction contexts)</li>
<li><code>reduction</code> / <code>contraction</code>: rules for how a term should be reduced</li>
<li><code>plug</code>: rules for how to recompose a full program expression given an evaluation context and a term</li>
</ul>
<p>In reduction semantics some terms are considered fully reduced (values), and others can be decomposed. In general a term can be decomposed in many ways, however</p>
<p>Often reduction semantics satisfy the property that there is a unique <em>complete</em> decomposition. A decomposition is <em>complete</em> iff the term it decomposes into a term that is trivially reducible (not a value, and not itself containing a complete decomposition). For example, the call-by-value simple lambda calculus semantics has the following reduction contexts</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>:</mo><mo>:</mo><mo>=</mo><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mo>∣</mo><mi>a</mi><mi>p</mi><mi>p</mi><mo stretchy="false">(</mo><mi>C</mi><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">)</mo><mo>∣</mo><mi>a</mi><mi>p</mi><mi>p</mi><mo stretchy="false">(</mo><mi>v</mi><mo separator="true">,</mo><mi>C</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C ::= [] \mid app(C,t) \mid app(v,C)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">::=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">pp</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">pp</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="mclose">)</span></span></span></span></p>
<p>where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span></span></span></span> denotes a reduction context, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em"></span><span class="mord mathnormal">t</span></span></span></span> a term, and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.03588em">v</span></span></span></span> a value, with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mclose">]</span></span></span></span> being a hole.</p>
<p>Crucially the restriction on the first term of the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>p</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">app</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">pp</span></span></span></span> being either an evaluation context, or a value makes this decomposition unique and specifies a left-to-right evaluation order.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deriving-an-abstract-machine">Deriving An Abstract Machine<a href="#deriving-an-abstract-machine" class="hash-link" aria-label="Direct link to Deriving An Abstract Machine" title="Direct link to Deriving An Abstract Machine">​</a></h3>
<p>Given this property, the paper shows how to derive an abstract machine from it.</p>
<p>Intuitively, instead of finding the decomposition and replugging after every step, we can
instead traverse the reduction contexts of the previous decomposition to find the next
reduction step and recompose the evaluation contexts to obtain the new evaluation context.
In this way we can merge all intermediate steps of <code>plug</code> followed by <code>reduction</code>. The paper
calls this the <code>refocus</code> step.</p>
<p>After merging <code>plug</code> and <code>reduction</code>, the only thing that we need to get rid of is to inline the <code>refocus</code> step itself to get a properly tail recursive abstract machine.</p>
<p>Of course the paper goes into more detail, and considers two separate <code>refocus</code> functions, one
which applies when the expression reduces to another potential redux, and another when it reduces to a value.
After inlining both, the differences don&#x27;t exactly matter, since they are now just part of the machine transitions.
However, it is useful to understand how the machine is derived, since you don&#x27;t always have an abstract machine, but do know how to select the next statement to reduce.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>The conclusion of the paper states:</p>
<blockquote>
<p>We have presented a structural result about reduction semantics with context-free grammars of values, reduction contexts, and redexes, and satisfying a unique-decomposition property. These conditions are quite general: they hold for deterministic languages and also for oracle-based non-deterministic languages.</p>
</blockquote>
<p>I appreciate the examples that they showed to make this claim more concrete - instead of solely in terms of context-free grammars, but it is nice to know that there is very little syntactic restrictions, and that the conditions for applying it are rather general.</p>
<blockquote>
<p>The construction of the refocus function suggests a convenient definition of the decompose function that directly connects one-step reduction and evaluation in the form of an abstract machine. It also suggests a practical method to obtain a reduction semantics out of an abstract machine.</p>
</blockquote>
<p>I wish they spent more time connecting this - how to go in the reverse direction. It is also interesting that they don&#x27;t talk about the restriction to <code>one-step</code> reductions. Is that a restriction only going in the reverse, or is it a restriction in the forward direction as well.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>A many step strategy is apparently one in which a whole set of redexes is contracted simultaneously</p><p>As such, the restriction makes sense and I believe applies in both directions. What would an abstract machine that performs multiple steps simultaneously even look like?</p></div></div>
<div id="refs" class="references csl-bib-body">
  <div class="csl-entry" id="bib-danvy_refocusing_2004">Olivier Danvy, and Lasse R. Nielsen. “Refocusing in Reduction Semantics.” <i>BRICS Report Series</i> 11 (26). Nov. 2004. doi:10.7146/brics.v11i26.21851.</div>
</div></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/paper">paper</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/abstract-interpreters">abstract interpreters</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/reduction-semantics">reduction semantics</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/byu-static-analysis-lab/blog/tree/main/blog/2024-11-refocusing-reduction.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/fine-grained-reduction-theory-for-effect-handlers"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Paper - A General Fine-Grained Reduction Theory for Effect Handlers</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/flow-sensitivity"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Topic - Flow Sensitivity</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#reduction-semantics" class="table-of-contents__link toc-highlight">Reduction Semantics</a></li><li><a href="#deriving-an-abstract-machine" class="table-of-contents__link toc-highlight">Deriving An Abstract Machine</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/byu-static-analysis-lab/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 BYU Static Analysis. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>