"use strict";(self.webpackChunkdev_blog=self.webpackChunkdev_blog||[]).push([[156],{9839:(e,s,a)=>{a.r(s),a.d(s,{assets:()=>m,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>n,toc:()=>c});var n=a(3795),t=a(4848),l=a(8453);const i={slug:"fine-grained-reduction-theory-for-effect-handlers",title:"Paper - A General Fine-Grained Reduction Theory for Effect Handlers",date:"2024-11-08T12:00",authors:["tim"],tags:["paper","abstract interpreters","reduction semantics","effect handlers","abstract machine"]},r=void 0,m={authorsImageUrls:[void 0]},c=[];function h(e){const s={a:"a",annotation:"annotation",code:"code",div:"div",i:"i",math:"math",mi:"mi",mo:"mo",mrow:"mrow",mstyle:"mstyle",mtable:"mtable",mtd:"mtd",mtext:"mtext",mtr:"mtr",p:"p",semantics:"semantics",span:"span",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(s.p,{children:["A General Fine-Grained Reduction Theory for Effect Handlers ",(0,t.jsx)(s.span,{className:"",id:"citation--sieczkowski_general_2023--1",children:"(Sieczkowski et al. 2023)"}),"\npresents a theory of effect handlers that can be used for term rewriting systems,\nand provides a few different abstract machines for effect handlers."]}),"\n",(0,t.jsx)(s.p,{children:"A significant contribution of this paper I believe is that it provides\na top down small-step semantics for effect handlers, which is a bit unusual."}),"\n",(0,t.jsx)(s.p,{children:"One disadvantages of most reduction semantics for effect handlers is that\nthey require being able to capture a reduction context itself as a term in the language.\nThis is easy to understand in principle, but makes the reduction semantics\nhard to translate into an abstract machine."}),"\n",(0,t.jsxs)(s.p,{children:["The fine-grained reduction theory presented in this paper makes it easy to apply the\nnormal refocusing method to come up with an abstract machine for algebraic effects (see ",(0,t.jsx)(s.a,{href:"/blog/refocusing-reduction",children:"this paper"}),")."]}),"\n",(0,t.jsx)(s.p,{children:"The crux of the idea is that continuations can either be built from the top-down or the bottom-up."}),"\n",(0,t.jsx)(s.p,{children:"Typical reduction semantics for algebraic effects capture the reduction context and wrap it in a closure to plug the context. This is effectively a bottom-up approach."}),"\n",(0,t.jsxs)(s.p,{children:["For example in Generalized Evidence Passing for Effect Handlers ",(0,t.jsx)(s.span,{className:"",id:"citation--xie_generalized_2021--2",children:"(Xie and Leijen 2021)"}),",\nKoka's evaluation rules look as follows:"]}),"\n",(0,t.jsx)(s.span,{className:"katex-display fleqn",children:(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mtable,{rowspacing:"0.25em",columnalign:"right left",columnspacing:"0em",children:[(0,t.jsxs)(s.mtr,{children:[(0,t.jsx)(s.mtd,{children:(0,t.jsx)(s.mstyle,{scriptlevel:"0",displaystyle:"true",children:(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{stretchy:"false",children:"("}),(0,t.jsx)(s.mi,{children:"a"}),(0,t.jsx)(s.mi,{children:"p"}),(0,t.jsx)(s.mi,{children:"p"}),(0,t.jsx)(s.mo,{stretchy:"false",children:")"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"})]})})}),(0,t.jsx)(s.mtd,{children:(0,t.jsx)(s.mstyle,{scriptlevel:"0",displaystyle:"true",children:(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mrow,{}),(0,t.jsx)(s.mo,{stretchy:"false",children:"("}),(0,t.jsx)(s.mi,{children:"\u03bb"}),(0,t.jsx)(s.mi,{children:"x"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"."}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mi,{children:"e"}),(0,t.jsx)(s.mo,{stretchy:"false",children:")"}),(0,t.jsx)(s.mi,{children:"v"}),(0,t.jsx)(s.mo,{children:"\u27f6"}),(0,t.jsx)(s.mi,{children:"e"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"["}),(0,t.jsx)(s.mi,{children:"x"}),(0,t.jsx)(s.mo,{children:":"}),(0,t.jsx)(s.mo,{children:"="}),(0,t.jsx)(s.mi,{children:"v"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"]"})]})})})]}),(0,t.jsxs)(s.mtr,{children:[(0,t.jsx)(s.mtd,{children:(0,t.jsx)(s.mstyle,{scriptlevel:"0",displaystyle:"true",children:(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{stretchy:"false",children:"("}),(0,t.jsx)(s.mi,{children:"h"}),(0,t.jsx)(s.mi,{children:"a"}),(0,t.jsx)(s.mi,{children:"n"}),(0,t.jsx)(s.mi,{children:"d"}),(0,t.jsx)(s.mi,{children:"l"}),(0,t.jsx)(s.mi,{children:"e"}),(0,t.jsx)(s.mi,{children:"r"}),(0,t.jsx)(s.mo,{stretchy:"false",children:")"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"})]})})}),(0,t.jsx)(s.mtd,{children:(0,t.jsx)(s.mstyle,{scriptlevel:"0",displaystyle:"true",children:(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mrow,{}),(0,t.jsx)(s.mtext,{mathvariant:"monospace",children:"handler"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mi,{children:"h"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mi,{children:"f"}),(0,t.jsx)(s.mo,{children:"\u27f6"}),(0,t.jsx)(s.mtext,{mathvariant:"monospace",children:"handle"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mi,{children:"h"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"("}),(0,t.jsx)(s.mi,{children:"f"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"("}),(0,t.jsx)(s.mo,{stretchy:"false",children:")"}),(0,t.jsx)(s.mo,{stretchy:"false",children:")"})]})})})]}),(0,t.jsxs)(s.mtr,{children:[(0,t.jsx)(s.mtd,{children:(0,t.jsx)(s.mstyle,{scriptlevel:"0",displaystyle:"true",children:(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{stretchy:"false",children:"("}),(0,t.jsx)(s.mi,{children:"r"}),(0,t.jsx)(s.mi,{children:"e"}),(0,t.jsx)(s.mi,{children:"t"}),(0,t.jsx)(s.mi,{children:"u"}),(0,t.jsx)(s.mi,{children:"r"}),(0,t.jsx)(s.mi,{children:"n"}),(0,t.jsx)(s.mo,{stretchy:"false",children:")"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"})]})})}),(0,t.jsx)(s.mtd,{children:(0,t.jsx)(s.mstyle,{scriptlevel:"0",displaystyle:"true",children:(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mrow,{}),(0,t.jsx)(s.mtext,{mathvariant:"monospace",children:"handle"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mi,{children:"h"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mi,{children:"v"}),(0,t.jsx)(s.mo,{children:"\u27f6"}),(0,t.jsx)(s.mi,{children:"v"})]})})})]}),(0,t.jsxs)(s.mtr,{children:[(0,t.jsx)(s.mtd,{children:(0,t.jsx)(s.mstyle,{scriptlevel:"0",displaystyle:"true",children:(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{stretchy:"false",children:"("}),(0,t.jsx)(s.mi,{children:"p"}),(0,t.jsx)(s.mi,{children:"e"}),(0,t.jsx)(s.mi,{children:"r"}),(0,t.jsx)(s.mi,{children:"f"}),(0,t.jsx)(s.mi,{children:"o"}),(0,t.jsx)(s.mi,{children:"r"}),(0,t.jsx)(s.mi,{children:"m"}),(0,t.jsx)(s.mo,{stretchy:"false",children:")"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"})]})})}),(0,t.jsx)(s.mtd,{children:(0,t.jsx)(s.mstyle,{scriptlevel:"0",displaystyle:"true",children:(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mrow,{}),(0,t.jsx)(s.mtext,{mathvariant:"monospace",children:"handle"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mi,{children:"h"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mi,{children:"E"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"["}),(0,t.jsx)(s.mtext,{mathvariant:"monospace",children:"perform"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mi,{children:"o"}),(0,t.jsx)(s.mi,{children:"p"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mi,{children:"v"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"]"}),(0,t.jsx)(s.mo,{children:"\u27f6"}),(0,t.jsx)(s.mi,{children:"f"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mi,{children:"v"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"("}),(0,t.jsx)(s.mi,{children:"\u03bb"}),(0,t.jsx)(s.mi,{children:"x"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"."}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mtext,{mathvariant:"monospace",children:"handle"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mi,{children:"h"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mi,{children:"E"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"["}),(0,t.jsx)(s.mi,{children:"x"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"]"}),(0,t.jsx)(s.mo,{stretchy:"false",children:")"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mtext,{mathvariant:"monospace",children:"iff"}),(0,t.jsx)(s.mtext,{children:"\u2005\u200a"}),(0,t.jsx)(s.mi,{children:"o"}),(0,t.jsx)(s.mi,{children:"p"}),(0,t.jsx)(s.mo,{mathvariant:"normal",children:"\u2209"}),(0,t.jsx)(s.mi,{children:"b"}),(0,t.jsx)(s.mi,{children:"o"}),(0,t.jsx)(s.mi,{children:"p"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"("}),(0,t.jsx)(s.mi,{children:"E"}),(0,t.jsx)(s.mo,{stretchy:"false",children:")"}),(0,t.jsx)(s.mo,{children:"\u2227"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"("}),(0,t.jsx)(s.mi,{children:"o"}),(0,t.jsx)(s.mi,{children:"p"}),(0,t.jsx)(s.mo,{children:"\u27fc"}),(0,t.jsx)(s.mi,{children:"f"}),(0,t.jsx)(s.mo,{stretchy:"false",children:")"}),(0,t.jsx)(s.mo,{children:"\u2208"}),(0,t.jsx)(s.mi,{children:"h"})]})})})]})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\begin{align*}\n(app)\\;\\; &(\u03bbx.\\; e) v \u27f6 e[x:=v]  \\\\\n(handler)\\;\\; &\\texttt{handler}\\; h\\; f \u27f6 \\texttt{handle}\\; h\\; (f\\; ()) \\\\\n(return)\\;\\; &\\texttt{handle}\\; h\\; v \u27f6 v  \\\\\n(perform)\\;\\; &\\texttt{handle}\\; h\\; E[\\texttt{perform}\\; op\\; v] \u27f6 \n  f\\; v\\; (\u03bbx.\\; \\texttt{handle}\\; h\\; E[x])\\; \\texttt{iff}\\; op \\notin bop(E) \u2227 (op \u27fc f)  \\in h\n\\end{align*}"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"6em",verticalAlign:"-2.75em"}}),(0,t.jsx)(s.span,{className:"mord",children:(0,t.jsxs)(s.span,{className:"mtable",children:[(0,t.jsx)(s.span,{className:"col-align-r",children:(0,t.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(s.span,{className:"vlist-r",children:[(0,t.jsxs)(s.span,{className:"vlist",style:{height:"3.25em"},children:[(0,t.jsxs)(s.span,{style:{top:"-5.41em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mopen",children:"("}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"a"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"pp"}),(0,t.jsx)(s.span,{className:"mclose",children:")"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]})]}),(0,t.jsxs)(s.span,{style:{top:"-3.91em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mopen",children:"("}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"han"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"d"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"er"}),(0,t.jsx)(s.span,{className:"mclose",children:")"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]})]}),(0,t.jsxs)(s.span,{style:{top:"-2.41em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mopen",children:"("}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"re"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"t"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"u"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"n"}),(0,t.jsx)(s.span,{className:"mclose",children:")"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]})]}),(0,t.jsxs)(s.span,{style:{top:"-0.91em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mopen",children:"("}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"p"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"er"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.10764em"},children:"f"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"or"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"m"}),(0,t.jsx)(s.span,{className:"mclose",children:")"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]})]})]}),(0,t.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(s.span,{className:"vlist-r",children:(0,t.jsx)(s.span,{className:"vlist",style:{height:"2.75em"},children:(0,t.jsx)(s.span,{})})})]})}),(0,t.jsx)(s.span,{className:"col-align-l",children:(0,t.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(s.span,{className:"vlist-r",children:[(0,t.jsxs)(s.span,{className:"vlist",style:{height:"3.25em"},children:[(0,t.jsxs)(s.span,{style:{top:"-5.41em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mord"}),(0,t.jsx)(s.span,{className:"mopen",children:"("}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"\u03bb"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"x"}),(0,t.jsx)(s.span,{className:"mord",children:"."}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"e"}),(0,t.jsx)(s.span,{className:"mclose",children:")"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"v"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mrel",children:"\u27f6"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"e"}),(0,t.jsx)(s.span,{className:"mopen",children:"["}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"x"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mrel",children:":="}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"v"}),(0,t.jsx)(s.span,{className:"mclose",children:"]"})]})]}),(0,t.jsxs)(s.span,{style:{top:"-3.91em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mord"}),(0,t.jsx)(s.span,{className:"mord text",children:(0,t.jsx)(s.span,{className:"mord texttt",children:"handler"})}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"h"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.10764em"},children:"f"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mrel",children:"\u27f6"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord text",children:(0,t.jsx)(s.span,{className:"mord texttt",children:"handle"})}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"h"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mopen",children:"("}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.10764em"},children:"f"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mopen",children:"("}),(0,t.jsx)(s.span,{className:"mclose",children:"))"})]})]}),(0,t.jsxs)(s.span,{style:{top:"-2.41em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mord"}),(0,t.jsx)(s.span,{className:"mord text",children:(0,t.jsx)(s.span,{className:"mord texttt",children:"handle"})}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"h"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"v"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mrel",children:"\u27f6"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"v"})]})]}),(0,t.jsxs)(s.span,{style:{top:"-0.91em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mord"}),(0,t.jsx)(s.span,{className:"mord text",children:(0,t.jsx)(s.span,{className:"mord texttt",children:"handle"})}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"h"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.05764em"},children:"E"}),(0,t.jsx)(s.span,{className:"mopen",children:"["}),(0,t.jsx)(s.span,{className:"mord text",children:(0,t.jsx)(s.span,{className:"mord texttt",children:"perform"})}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"o"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"p"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"v"}),(0,t.jsx)(s.span,{className:"mclose",children:"]"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mrel",children:"\u27f6"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.10764em"},children:"f"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"v"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mopen",children:"("}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"\u03bb"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"x"}),(0,t.jsx)(s.span,{className:"mord",children:"."}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord text",children:(0,t.jsx)(s.span,{className:"mord texttt",children:"handle"})}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"h"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.05764em"},children:"E"}),(0,t.jsx)(s.span,{className:"mopen",children:"["}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"x"}),(0,t.jsx)(s.span,{className:"mclose",children:"])"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord text",children:(0,t.jsx)(s.span,{className:"mord texttt",children:"iff"})}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"o"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"p"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsxs)(s.span,{className:"mrel",children:[(0,t.jsx)(s.span,{className:"mord",children:(0,t.jsx)(s.span,{className:"mrel",children:"\u2208"})}),(0,t.jsx)(s.span,{className:"mord vbox",children:(0,t.jsx)(s.span,{className:"thinbox",children:(0,t.jsxs)(s.span,{className:"llap",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsx)(s.span,{className:"inner",children:(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mord",children:"/"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.0556em"}})]})}),(0,t.jsx)(s.span,{className:"fix"})]})})})]}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"b"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"o"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"p"}),(0,t.jsx)(s.span,{className:"mopen",children:"("}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.05764em"},children:"E"}),(0,t.jsx)(s.span,{className:"mclose",children:")"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(s.span,{className:"mbin",children:"\u2227"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(s.span,{className:"mopen",children:"("}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"o"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"p"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mrel",children:"\u27fc"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.10764em"},children:"f"}),(0,t.jsx)(s.span,{className:"mclose",children:")"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mrel",children:"\u2208"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"h"})]})]})]}),(0,t.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(s.span,{className:"vlist-r",children:(0,t.jsx)(s.span,{className:"vlist",style:{height:"2.75em"},children:(0,t.jsx)(s.span,{})})})]})})]})})]})})]})}),"\n",(0,t.jsxs)(s.p,{children:["In this we can see the caputring of ",(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsx)(s.mrow,{children:(0,t.jsx)(s.mi,{children:"E"})}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"E"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.6833em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.05764em"},children:"E"})]})})]})," and wrapping up in a lambda to build the continuation.\nAdditionally we see the nature of ",(0,t.jsx)(s.code,{children:"deep"})," effect handlers where the continuation reinstates\nthe handler frame on top of the evaluation context."]}),"\n",(0,t.jsx)(s.p,{children:"While later in the Koka paper they present a monad for building up the continuation piece by piece, this is still a bottom-up treatment and composition of elementary evaluation contexts."}),"\n",(0,t.jsx)(s.p,{children:"Instead the top down treatment presented in this paper, builds the continuation on the way down, and only uses lambda functions."}),"\n",(0,t.jsxs)(s.p,{children:["The abstract machine presented in the paper is pretty straightforward, though as mentioned in the paper it is a ",(0,t.jsx)(s.code,{children:"hybrid"})," machine because the context changes how evaluation proceeds. In particular\nevaluation changes depending on whether it is in the context of one or more handlers, versus if it is finishing up a computation in the top level continuation."]}),"\n",(0,t.jsx)(s.p,{children:"Later they introduce a similarity relation to equate terms in the fine-grained calculus and a normal calculus. This part is pretty involved since the rewriting of handlers in the fine-grained calculus ends up changing a lot of terms, and the capturing of a resumption in the regular calculus introduces an eta expansion for the application."}),"\n",(0,t.jsx)(s.p,{children:"Next they present three core proofs: Simulation, Confluence, and Standardization."}),"\n",(0,t.jsx)(s.p,{children:"Simulation states that it doesn't matter whether you use the fine-grained or non-local semantics you get the same result. i.e. fine-grained simulates non-local and vice versa. One step in one either could correspond to many steps in the other, so you have to consider the transitive closure. Additionally the similarity relation is needed since the terms could look different but be syntactically or otherwise equivalent."}),"\n",(0,t.jsx)(s.p,{children:"Confluence of the relation is the diamond property meaning that if an expression reduces to two different expressions, then there exists an expression that each of those expressions can reduce further to."}),"\n",(0,t.jsx)(s.p,{children:"Standardization states the any reduction sequence that reaches head-normal form can be split into a sequence that reaches a normal form followed by an internal reduction sequence. This is tricky with effect handlers due to the hybrid nature of the semantics in which let and lift behave differently depending if a handler surrounds them."}),"\n",(0,t.jsx)(s.p,{children:"Using those proofs they show that the reduction theory is a foundation for an equational theory which is sound with respect to the non-local semantics. In other words, rewriting pieces of programs using this theory will result in the same program, even if you switch back to a non-local semantics to execute the rest."}),"\n",(0,t.jsxs)(s.div,{id:"refs",className:"references csl-bib-body",children:["\n  ",(0,t.jsxs)(s.div,{className:"csl-entry",id:"bib-sieczkowski_general_2023",children:["Filip Sieczkowski, Mateusz Pyzik, and Dariusz Biernacki. \u201cA General Fine-Grained Reduction Theory for Effect Handlers.\u201d ",(0,t.jsx)(s.i,{children:"Proceedings of the ACM on Programming Languages"})," 7 (ICFP): 511\u2013540. 2023. Publisher: ACM New York, NY, USA."]}),"\n  ",(0,t.jsxs)(s.div,{className:"csl-entry",id:"bib-xie_generalized_2021",children:["Ningning Xie, and Daan Leijen. \u201cGeneralized Evidence Passing for Effect Handlers.\u201d ",(0,t.jsx)(s.i,{children:"Microsoft Research. Extended Version with Proofs"}),". 2021."]}),"\n"]})]})}function d(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,s,a)=>{a.d(s,{R:()=>i,x:()=>r});var n=a(6540);const t={},l=n.createContext(t);function i(e){const s=n.useContext(l);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),n.createElement(l.Provider,{value:s},e.children)}},3795:e=>{e.exports=JSON.parse('{"permalink":"/blog/fine-grained-reduction-theory-for-effect-handlers","editUrl":"https://github.com/byu-static-analysis-lab/blog/tree/main/blog/2024-11-fine-grained-reduction-theory-for-effect-handlers.md","source":"@site/blog/2024-11-fine-grained-reduction-theory-for-effect-handlers.md","title":"Paper - A General Fine-Grained Reduction Theory for Effect Handlers","description":"A General Fine-Grained Reduction Theory for Effect Handlers [@sieczkowskigeneral2023]","date":"2024-11-08T12:00:00.000Z","tags":[{"inline":true,"label":"paper","permalink":"/blog/tags/paper"},{"inline":true,"label":"abstract interpreters","permalink":"/blog/tags/abstract-interpreters"},{"inline":true,"label":"reduction semantics","permalink":"/blog/tags/reduction-semantics"},{"inline":true,"label":"effect handlers","permalink":"/blog/tags/effect-handlers"},{"inline":true,"label":"abstract machine","permalink":"/blog/tags/abstract-machine"}],"readingTime":3.33,"hasTruncateMarker":true,"authors":[{"name":"Tim Whiting","title":"Author","url":"https://github.com/TimWhiting","imageURL":"https://github.com/TimWhiting.png","key":"tim","page":null}],"frontMatter":{"slug":"fine-grained-reduction-theory-for-effect-handlers","title":"Paper - A General Fine-Grained Reduction Theory for Effect Handlers","date":"2024-11-08T12:00","authors":["tim"],"tags":["paper","abstract interpreters","reduction semantics","effect handlers","abstract machine"]},"unlisted":false,"nextItem":{"title":"Paper - Refocusing in Reduction Semantics","permalink":"/blog/refocusing-reduction"}}')}}]);